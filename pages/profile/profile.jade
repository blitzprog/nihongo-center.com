mixin empty()
	.field

mixin text(mLabel, mId, mValue, mPlaceHolder, dataListId, disabled)
	if typeof mValue === "undefined"
		- mValue = user[mId]
	.field
		label(for=mId)= mLabel
		if disabled
			input(type="text", name=mId, id=mId, value=mValue, list=dataListId, placeholder=mPlaceHolder, title=mPlaceHolder, disabled).text-input
		else
			input(type="text", name=mId, id=mId, value=mValue, list=dataListId, placeholder=mPlaceHolder, title=mPlaceHolder).text-input

mixin textInArray(mLabel, mArray, mIndex, mKey, mValue, mPlaceHolder, dataListId)
	- var mId = mArray + "-" + mIndex + "-" + mKey
	.field
		label(for=mId)= mLabel
		input(type="text", name=mId, id=mId, value=mValue, placeholder=mPlaceHolder, title=mPlaceHolder, list=dataListId, data-array=mArray, data-index=mIndex, data-key=mKey).array-text-input

mixin number(mLabel, mId, mValue, mPlaceHolder)
	if typeof mValue === "undefined"
		- mValue = user[mId]
	.field
		label(for=mId)= mLabel
		input(type="number", name=mId, id=mId, value=mValue, placeholder=mPlaceHolder, title=mPlaceHolder).number-input

mixin numberInObject(mLabel, mObject, mKey, mPlaceHolder)
	- var mId = mObject + "-" + mKey
	- var mValue = user[mObject][mKey]
	.field
		label(for=mId)= mLabel
		input(type="number", name=mId, id=mId, value=mValue, placeholder=mPlaceHolder, title=mPlaceHolder, data-object=mObject, data-key=mKey).object-number-input

mixin tel(mLabel, mId, mValue, mPlaceHolder)
	.field
		label(for=mId)= mLabel
		input(type="tel", name=mId, id=mId, value=mValue, placeholder=mPlaceHolder, title=mPlaceHolder).tel-input

mixin date(mLabel, mId, mValue)
	if typeof mValue === "undefined"
		- mValue = user[mId]
	.field
		label(for=mId)= mLabel
		input(type="date", name=mId, id=mId, value=mValue).date-input

mixin month(mLabel, mId, mValue)
	.field
		label(for=mId)= mLabel
		input(type="month", name=mId, id=mId, value=mValue).date-input

mixin select(mLabel, mId, mValue, mOptions)
	.field
		label(for=mId)= mLabel
		select(name=mId, id=mId)
			each option in mOptions
				if option.value === mValue || (typeof mValue === "undefined" && option.value === "")
					if option.disabled === true
						option(value=option.value, disabled, selected)= option.name
					else
						option(value=option.value, selected)= option.name
				else
					if option.disabled === true
						option(value=option.value, disabled)= option.name
					else
						option(value=option.value)= option.name

mixin datalist(mId, mOptions)
	datalist(id=mId)
		each val in mOptions
			option(value=val)

if user
	h2 Personal
	
	+datalist("cities", cities)
	+datalist("countries", countries)
	+datalist("nationalities", nationalities)
	
	.profile
		+text("Given name:", "givenName")
		+text("Family name:", "familyName")
		
		+select("Gender:", "gender", user.gender, genderOptions)
		+select("Marital status:", "maritalStatus", user.maritalStatus, maritalStatusOptions)
		
		+date("Birthday:", "birthDay", user.birthDay)
		+text("Age:", "age", age, "", "", true)
		
		+text("Birthplace:", "birthPlace", user.birthPlace, "", "cities")
		+text("Nationality:", "nationality", user.nationality, "", "nationalities")
		
		+text("Occupation:", "occupation", user.occupation)
		+select("Occupation type:", "occupationType", user.occupationType, occupationTypeOptions)
		
		+text("Home address:", "address", user.address, "üè†")
		+text("Address in Japan:", "addressAbroad", user.addressAbroad, "üè† Only if you have one.")
		
		+tel("Telephone:", "telephone", user.telephone, "‚òé")
		+tel("Telephone in Japan:", "telephoneAbroad", user.telephoneAbroad, "‚òé Only if you have one.")
	
	h2 Course
	.profile
		+select("Course:", "course", user.course, courseOptions)
		+empty()
		
		+select("Start year:", "startYear", user.startYear, startYearOptions)
		+select("Start month:", "startMonth", user.startMonth, startMonthOptions)
		
	h2 Education
	.profile
		+select("Education:", "education", user.education, educationOptions)
		+text("Name of educational institution:", "educationalInstitutionName", user.educationalInstitutionName, "School or university name")
		
		+month("Graduation date:", "graduationDate", user.graduationDate)
		+select("Plan after graduating from Nihongo Center:", "planAfterGraduation", user.planAfterGraduation, planAfterGraduationOptions)
		
		+number("Total period of education:", "totalPeriodOfEducation", undefined, "How many years?")
		
	h2 Passport
	.profile
		+text("Passport number:", "passportId", user.passportId, "e.g. TK1234567")
		+empty()
		
		+date("Passport date of issue:", "passportDateOfIssue", user.passportDateOfIssue)
		+date("Passport date of expiration:", "passportDateOfExpiration", user.passportDateOfExpiration)
	
	h2 Family
	#family-members.profile
		each member, index in user.familyMembers
			.family-member.profile
				+textInArray("Full name:", "familyMembers", index, "name", member.name)
				+textInArray("Relation:", "familyMembers", index, "relation", member.relation)
				+textInArray("Age:", "familyMembers", index, "age", member.age)
				+textInArray("Occupation:", "familyMembers", index, "occupation", member.occupation)
				+textInArray("Nationality:", "familyMembers", index, "nationality", member.nationality, "", "nationalities")
				+textInArray("Country:", "familyMembers", index, "country", member.country, "", "countries")
				a(href="javascript:removeFamilyMember(" + index + ");").delete-button Delete
		
		a(href="javascript:addFamilyMember();") Add family member
	
	h2 Finances
	p
		| Please enter the average amount of support 
		strong per month 
		| in Yen (¬•).
	.profile
		+numberInObject("Self:", "financialSupportPerMonth", "self", "Monthly amount in Yen (¬•)")
		+numberInObject("Remittance from outside Japan:", "financialSupportPerMonth", "remittanceFromOutside", "Monthly amount in Yen (¬•)")
		+numberInObject("Carrying from abroad:", "financialSupportPerMonth", "carryingFromAbroad", "Monthly amount in Yen (¬•)")
		+numberInObject("Guarantor in Japan:", "financialSupportPerMonth", "guarantorAbroad", "Monthly amount in Yen (¬•)")
		+numberInObject("Scholarship:", "financialSupportPerMonth", "scholarship", "Monthly amount in Yen (¬•)")
		+numberInObject("Others:", "financialSupportPerMonth", "others", "Monthly amount in Yen (¬•)")
	
	h2 Visa
	.profile
		+select("Port of entry:", "portOfEntry", user.portOfEntry, portsOfEntry)
		+text("Place to apply for a visa in your country:", "visaApplicationPlace", undefined, "üè¢ Location of closest Japanese Embassy or Consulate")
	
	h2 Japanese
	.profile
		+select("Acquired JLPT level (Japanese Language Proficiency Test):", "jlptLevel", user.jlptLevel, jlptLevels)
		+number("Number of past entries into Japan:", "numberOfPastEntries", undefined, "How often did you go to Japan?")
		+date("Last entry from:", "lastEntryFrom")
		+date("Last entry to:", "lastEntryTo")
		
	script
		include save.js
else
	p Not logged in!